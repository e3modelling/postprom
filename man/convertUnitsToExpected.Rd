% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/helpers.R
\name{convertUnitsToExpected}
\alias{convertUnitsToExpected}
\title{Convert units in a magpie object to expected units}
\usage{
convertUnitsToExpected(
  magpieObj,
  unitTable,
  usd2015to2010,
  allowUnrecognized = FALSE,
  quiet = FALSE
)
}
\arguments{
\item{magpieObj}{A magpie object whose third-dimension item names follow the
pattern `"variable (unit)"`. Values will be scaled in-place for variables
requiring conversion.}

\item{unitTable}{A data.frame with (at least) the columns:
`variable`, `magpieUnit`, `expectedUnit`, and `unitMatches`.
Rows with `unitMatches` not `TRUE` are treated as mismatches to convert.
`variable` should match the variable name *without* the trailing `" (unit)"`
part in the magpie object.}

\item{usd2015to2010}{Numeric scalar deflator to convert values from USD_2015 to
USD_2010 (multiplicative factor). Used for currency and price conversions.}

\item{allowUnrecognized}{Logical. If `FALSE` (default), unsupported unit pairs
cause an error and the function stops. If `TRUE`, unsupported conversions are
skipped (with a warning) and the variable name is recorded in `skipped`.}

\item{quiet}{Logical. If `FALSE` (default), prints a short summary of how many
variables were converted and shows the first rows of the conversion log.}
}
\value{
A list with:
\describe{
  \item{object}{The converted magpie object (same class as input).}
  \item{log}{A data.frame recording each successful conversion with columns
    `variable`, `fromUnit`, `toUnit`, `factorUsed`.}
  \item{skipped}{Character vector of variables skipped due to unsupported unit
    pairs (only non-empty when `allowUnrecognized = TRUE`).}
}
}
\description{
Converts variables in a magpie object (dimension 3 items) from the units found
in the object to the units expected by a provided unit table. Conversions are
applied variable-by-variable using audited, hard-coded conversion factors for
a limited set of supported unit pairs (energy quantities, selected prices,
population scaling, and macro aggregates).
}
\details{
The function updates both the numeric values (by multiplying with a conversion
factor) and the unit labels embedded in the third-dimension item names
(e.g. `"GDP (billion USD_2010/yr)"`). Unsupported conversions either stop with an 
error (default) or are skipped with a warning if `allowUnrecognized = TRUE`.
}
\examples{
\dontrun{
# unitTable is expected to have: variable, magpieUnit, expectedUnit, unitMatches
res <- convertUnitsToExpected(
  magpieObj        = x,
  unitTable        = unitTable,
  usd2015to2010    = 0.93,
  allowUnrecognized = TRUE
)}
}
